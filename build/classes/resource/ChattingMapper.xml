<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="sopms.chatting.dao.ChattingDao">

	<insert id="insertMessage" parameterType="sopms.vo.Message" useGeneratedKeys="true" keyProperty="sendtime">
	insert into message
	(sender_id, messagebody)
	values 
	(#{sender_id}, #{messageBody})	
	</insert>
	
	<select id="teamlist" parameterType="String" resultType="User">
	select * from member a, lesource b
	where a.id=b.id and b.pcode in(select pcode
	from lesource
	where id=#{id})
	</select>
	
	<select id="checkRoom" parameterType="hashMap" resultType="integer">
	select CHATROOM_ID from CHATROOM_PART
	where MEMBERNAME = #{toId}
	intersect
	select CHATROOM_ID from CHATROOM_PART
	where MEMBERNAME = #{currentId}
	</select>
	
	<insert id="newRoom" parameterType= "sopms.vo.Chatroom">
		<selectKey order="BEFORE" resultType="int" keyProperty="chatroomId">
			select chatroom_seq.nextval from dual
		</selectKey>
	insert into chatroom
	(chatroom_id, chattype)
	values
	(#{chatroomId}, #{chatType})
	</insert>
	
	<insert id="newRoomPart" parameterType= "sopms.vo.ChatroomPart">
	insert into chatroom_part
	(chatroom_id, membername)
	values
	(#{chatroomId}, #{memberName})
	</insert>
	
</mapper>